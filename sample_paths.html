<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sample Paths</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="sample_paths_files/libs/clipboard/clipboard.min.js"></script>
<script src="sample_paths_files/libs/quarto-html/quarto.js"></script>
<script src="sample_paths_files/libs/quarto-html/popper.min.js"></script>
<script src="sample_paths_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sample_paths_files/libs/quarto-html/anchor.min.js"></script>
<link href="sample_paths_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sample_paths_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sample_paths_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sample_paths_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sample_paths_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sample Paths</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Source: Stochastic Modeling: Analysis and Simulation. Barry L. Nelson 1995.</em></p>
<p><br></p>
<p><em><strong>Motivating Example:</strong> A copy shop currently has one copy machine and one clerk. Customers arrive and form a single queue, then are provide full service in the order of arrival. The copy shop would like to expand services by providing a second copy machine and a second clerk. The shop would like to know whether it would be more effective to continue providing full service to all customers, or to allow the new copy machine to be available for self-service.</em></p>
<p><em>The single employee at the copy shop collects data for two hours one morning. Customers are counted as they arrive. Arrival times are indicated by</em> <code>clock = &lt;hour&gt;.&lt;minute&gt;</code>. <code>action</code> refers to customer <code>a = arrival</code>, <code>f = finish</code>. <code>comment</code> includes whether the customer required special handling services. A total of 20 customers were observed.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   clock customer action           comment
1   9.00        0   &lt;NA&gt;        shop opens
2   9.12        1      a                 0
3   9.14        2      a                 0
4   9.17        3      a                 0
5   9.19        1      f   collate, staple
6   9.21        2      f                 0
7   9.22        3      f                 0
8   9.38        4      a                 0
9   9.39        5      a                 0
10  9.41        4      f                 0
11  9.43        6      a                 0
12  9.45        7      a                 0
13  9.52        8      a                 0
14  9.57        5      f     special paper
15  9.58        9      a                 0
16 10.00        6      f                 0
17 10.01        7      f                 0
18 10.08        8      f                 0
19 10.11        9      f   collate, covers
20 10.13       10      a                 0
21 10.14       11      a                 0
22 10.16       12      a                 0
23 10.19       13      a                 0
24 10.24       10      f two-sided, staple
25 10.26       11      f                 0
26 10.28       14      a                 0
27 10.36       12      f                 0
28 10.36       15      a                 0
29 10.38       13      f                 0
30 10.39       14      f                 0
31 10.42       15      f   collate, staple
32 10.45       16      a                 0
33 10.47       16      f                 0
34 10.48       17      a                 0
35 10.50       17      f                 0
36 10.53       18      a                 0
37 10.58       19      a                 0
38 11.00       20      a                 0
39 11.01       18      f     special paper
40 11.07       19      f two-sided, staple
41 11.09       20      f   collate, staple</code></pre>
</div>
</div>
<p><br></p>
<section id="sample-path-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="sample-path-decomposition">Sample Path Decomposition</h2>
<p><strong>Stochastic processes</strong> are those which involve randomness. In the example above, we can imagine several random processes, including customer arrival times, finish times, service times, and queue times.</p>
<p>To calculate service times from the data above, we will need to first perform several pre-processing (i.e., data handling) steps. First, we must convert clock time into a count of minutes since <em>time = 0</em>, the time when the shop opens. To prepare the data for visualizations and simulations, we will convert the <code>action</code> column into arrival and finish columns. We will also convert the <code>comments</code> column into an indicator variable of <code>self-service = 0 / full-service = 1</code>. Finally, we will reformat the dataset to customer number as row identifier (rather than time).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate service_length, which is assumed to be independent of proposed changes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># 1) Convert clock times to minutes past "start" time = 0</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>   <span class="co"># 2) Convert action column into arrive and finish columns</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>   <span class="co"># 3) Convert comment into dichotomous self-service (0) / full-service (1)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>   <span class="co"># 4) Reformat dataset to customer number as row identifier (rather than time)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">#- Copy previous dataset</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> raw_data</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>   <span class="co">#- 1) Convert all clock times to minutes past store opening</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>time <span class="ot">&lt;-</span> data1<span class="sc">$</span>clock <span class="sc">-</span> <span class="dv">9</span>   <span class="co"># set store open to 0</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time = transformed time</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data1<span class="sc">$</span>time <span class="sc">&lt;</span> <span class="dv">1</span>,   <span class="co"># if arrival in 9 o'clock hour</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                     data1<span class="sc">$</span>time<span class="sc">*</span><span class="dv">100</span>,       <span class="co"># transform by making decimal into minutes</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                     data1<span class="sc">$</span>time)           <span class="co"># else do not transform</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data1<span class="sc">$</span>time <span class="sc">&lt;</span> <span class="dv">2</span>,   <span class="co"># if arrival in 10 o'clock hour</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                     (data1<span class="sc">$</span>time <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span> <span class="sc">+</span> <span class="dv">60</span>, <span class="co"># remove 10 o'clock indicator</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                     data1<span class="sc">$</span>time)                <span class="co"># transform decimal to minutes</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># add 60 minutes for 10 o'clock hour</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data1<span class="sc">$</span>time <span class="sc">&lt;</span> <span class="dv">3</span>,   <span class="co"># if arrival in 11 o'clock hour</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                     (data1<span class="sc">$</span>time <span class="sc">-</span> <span class="dv">2</span>)<span class="sc">*</span><span class="dv">100</span> <span class="sc">+</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span>,   <span class="co"># remove 11 o'clock indicator</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                     data1<span class="sc">$</span>time)                    <span class="co"># transform decimal to minutes</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                                                        <span class="co"># add 120 minutes for 11 o'clock hour</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>time[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># fix time = 0</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>data1  <span class="co">#-- check Step 1 was performed correctly. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   clock customer action           comment time
1   9.00        0   &lt;NA&gt;        shop opens    0
2   9.12        1      a                 0   12
3   9.14        2      a                 0   14
4   9.17        3      a                 0   17
5   9.19        1      f   collate, staple   19
6   9.21        2      f                 0   21
7   9.22        3      f                 0   22
8   9.38        4      a                 0   38
9   9.39        5      a                 0   39
10  9.41        4      f                 0   41
11  9.43        6      a                 0   43
12  9.45        7      a                 0   45
13  9.52        8      a                 0   52
14  9.57        5      f     special paper   57
15  9.58        9      a                 0   58
16 10.00        6      f                 0   60
17 10.01        7      f                 0   61
18 10.08        8      f                 0   68
19 10.11        9      f   collate, covers   71
20 10.13       10      a                 0   73
21 10.14       11      a                 0   74
22 10.16       12      a                 0   76
23 10.19       13      a                 0   79
24 10.24       10      f two-sided, staple   84
25 10.26       11      f                 0   86
26 10.28       14      a                 0   88
27 10.36       12      f                 0   96
28 10.36       15      a                 0   96
29 10.38       13      f                 0   98
30 10.39       14      f                 0   99
31 10.42       15      f   collate, staple  102
32 10.45       16      a                 0  105
33 10.47       16      f                 0  107
34 10.48       17      a                 0  108
35 10.50       17      f                 0  110
36 10.53       18      a                 0  113
37 10.58       19      a                 0  118
38 11.00       20      a                 0  120
39 11.01       18      f     special paper  121
40 11.07       19      f two-sided, staple  127
41 11.09       20      f   collate, staple  129</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#- 2) Split times into arrivals and finish to prepare for reformating dataset</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>     <span class="co">#- Initiate a new "arrive" column</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>arrive <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(data1))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#- Transfer times to arrive if arrival times</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>arrive <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data1<span class="sc">$</span>action <span class="sc">==</span> <span class="st">"a"</span>, data1<span class="sc">$</span>customer, <span class="dv">0</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#- Initiate a new "finish" column</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>finish <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(data1))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#- Transfer times to finish if finish times</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>finish <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data1<span class="sc">$</span>action <span class="sc">==</span> <span class="st">"f"</span>, data1<span class="sc">$</span>customer, <span class="dv">0</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>data1 <span class="co">#-- Check Step 2 was performed correctly</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   clock customer action           comment time arrive finish
1   9.00        0   &lt;NA&gt;        shop opens    0     NA     NA
2   9.12        1      a                 0   12      1      0
3   9.14        2      a                 0   14      2      0
4   9.17        3      a                 0   17      3      0
5   9.19        1      f   collate, staple   19      0      1
6   9.21        2      f                 0   21      0      2
7   9.22        3      f                 0   22      0      3
8   9.38        4      a                 0   38      4      0
9   9.39        5      a                 0   39      5      0
10  9.41        4      f                 0   41      0      4
11  9.43        6      a                 0   43      6      0
12  9.45        7      a                 0   45      7      0
13  9.52        8      a                 0   52      8      0
14  9.57        5      f     special paper   57      0      5
15  9.58        9      a                 0   58      9      0
16 10.00        6      f                 0   60      0      6
17 10.01        7      f                 0   61      0      7
18 10.08        8      f                 0   68      0      8
19 10.11        9      f   collate, covers   71      0      9
20 10.13       10      a                 0   73     10      0
21 10.14       11      a                 0   74     11      0
22 10.16       12      a                 0   76     12      0
23 10.19       13      a                 0   79     13      0
24 10.24       10      f two-sided, staple   84      0     10
25 10.26       11      f                 0   86      0     11
26 10.28       14      a                 0   88     14      0
27 10.36       12      f                 0   96      0     12
28 10.36       15      a                 0   96     15      0
29 10.38       13      f                 0   98      0     13
30 10.39       14      f                 0   99      0     14
31 10.42       15      f   collate, staple  102      0     15
32 10.45       16      a                 0  105     16      0
33 10.47       16      f                 0  107      0     16
34 10.48       17      a                 0  108     17      0
35 10.50       17      f                 0  110      0     17
36 10.53       18      a                 0  113     18      0
37 10.58       19      a                 0  118     19      0
38 11.00       20      a                 0  120     20      0
39 11.01       18      f     special paper  121      0     18
40 11.07       19      f two-sided, staple  127      0     19
41 11.09       20      f   collate, staple  129      0     20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#- 3) Convert comment column into self-serve/full-serve</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#- Initiate column</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>full_service <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(data1))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#- replace any characters with 1</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>full_service <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data1<span class="sc">$</span>comment <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>data1 <span class="co">#-- Check Step 3 was performed correctly</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   clock customer action           comment time arrive finish full_service
1   9.00        0   &lt;NA&gt;        shop opens    0     NA     NA            1
2   9.12        1      a                 0   12      1      0            0
3   9.14        2      a                 0   14      2      0            0
4   9.17        3      a                 0   17      3      0            0
5   9.19        1      f   collate, staple   19      0      1            1
6   9.21        2      f                 0   21      0      2            0
7   9.22        3      f                 0   22      0      3            0
8   9.38        4      a                 0   38      4      0            0
9   9.39        5      a                 0   39      5      0            0
10  9.41        4      f                 0   41      0      4            0
11  9.43        6      a                 0   43      6      0            0
12  9.45        7      a                 0   45      7      0            0
13  9.52        8      a                 0   52      8      0            0
14  9.57        5      f     special paper   57      0      5            1
15  9.58        9      a                 0   58      9      0            0
16 10.00        6      f                 0   60      0      6            0
17 10.01        7      f                 0   61      0      7            0
18 10.08        8      f                 0   68      0      8            0
19 10.11        9      f   collate, covers   71      0      9            1
20 10.13       10      a                 0   73     10      0            0
21 10.14       11      a                 0   74     11      0            0
22 10.16       12      a                 0   76     12      0            0
23 10.19       13      a                 0   79     13      0            0
24 10.24       10      f two-sided, staple   84      0     10            1
25 10.26       11      f                 0   86      0     11            0
26 10.28       14      a                 0   88     14      0            0
27 10.36       12      f                 0   96      0     12            0
28 10.36       15      a                 0   96     15      0            0
29 10.38       13      f                 0   98      0     13            0
30 10.39       14      f                 0   99      0     14            0
31 10.42       15      f   collate, staple  102      0     15            1
32 10.45       16      a                 0  105     16      0            0
33 10.47       16      f                 0  107      0     16            0
34 10.48       17      a                 0  108     17      0            0
35 10.50       17      f                 0  110      0     17            0
36 10.53       18      a                 0  113     18      0            0
37 10.58       19      a                 0  118     19      0            0
38 11.00       20      a                 0  120     20      0            0
39 11.01       18      f     special paper  121      0     18            1
40 11.07       19      f two-sided, staple  127      0     19            1
41 11.09       20      f   collate, staple  129      0     20            1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#- 4) Recast dataset to customer ID as row identifier</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data1[<span class="sc">-</span><span class="dv">1</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>]  <span class="co"># Reorder columns and drop unnecessary ones</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>   <span class="co">#- initiate two new columns, time1 (= arrive time) and time2 (= finish time)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>time1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>time2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)  {     <span class="co">#for each of 1:20 customers</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  time1[i] <span class="ot">&lt;-</span> data2<span class="sc">$</span>time[<span class="fu">which</span>(data2<span class="sc">$</span>arrive <span class="sc">==</span> i)]  <span class="co"># for arrival == CustomerID, collect time</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  time2[i] <span class="ot">&lt;-</span> data2<span class="sc">$</span>time[<span class="fu">which</span>(data2<span class="sc">$</span>finish <span class="sc">==</span> i)]  <span class="co"># for finish == CustomerID, collect time</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>   <span class="co">#- Service time for customer 1 is time2[1] - time1[1]</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>   <span class="co">#- For all others, service_length begins at max(previous customer's finish, current customer's start)</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>   <span class="co">#- Also capture wait_time_factual for testing simulations later</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>service_length <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>wait_time_factual <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>service_length[<span class="dv">1</span>] <span class="ot">&lt;-</span> time2[<span class="dv">1</span>] <span class="sc">-</span> time1[<span class="dv">1</span>]</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">max</span>(time2[i<span class="dv">-1</span>], time1[i])</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  wait_time_factual[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(time2[i<span class="dv">-1</span>] <span class="sc">&gt;</span> time1[i], <span class="fu">diff</span>(<span class="fu">c</span>(time1[i], time2[i<span class="dv">-1</span>])), <span class="dv">0</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  service_length[i] <span class="ot">&lt;-</span> time2[i] <span class="sc">-</span> start_time</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>   <span class="co">#- Flag full-service by customer ID instead of time</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>   <span class="co">#- Also capture arrival times for simulations later</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>full_service <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>arrive_time <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  full_service[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data2<span class="sc">$</span>full_service[<span class="fu">which</span>(data2<span class="sc">$</span>finish <span class="sc">==</span> i)] <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  arrive_time[i] <span class="ot">&lt;-</span> data2<span class="sc">$</span>time[data2<span class="sc">$</span>arrive <span class="sc">==</span> i]</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">customer =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,       <span class="co"># Table 2.2</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">service_length =</span> service_length, </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">full_service =</span> full_service, </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">arrive_time =</span> arrive_time, </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wait_time_factual =</span> wait_time_factual</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   customer service_length full_service arrive_time wait_time_factual
1         1              7            1          12                 0
2         2              2            0          14                 5
3         3              1            0          17                 4
4         4              3            0          38                 0
5         5             16            1          39                 2
6         6              3            0          43                14
7         7              1            0          45                15
8         8              7            0          52                 9
9         9              3            1          58                10
10       10             11            1          73                 0
11       11              2            0          74                10
12       12             10            0          76                10
13       13              2            0          79                17
14       14              1            0          88                10
15       15              3            1          96                 3
16       16              2            0         105                 0
17       17              2            0         108                 0
18       18              8            1         113                 0
19       19              6            1         118                 3
20       20              2            1         120                 7</code></pre>
</div>
</div>
<p>Now that we have processed the data, we can visualize service times for all customers, as well as stratify by potential service types, with potential self-service customers as those with no special handling needs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate means/sds for reference in figure</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mean_f <span class="ot">&lt;-</span> <span class="fu">mean</span>(table2<span class="sc">$</span>service_length[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>sd_f <span class="ot">&lt;-</span> <span class="fu">sd</span>(table2<span class="sc">$</span>service_length[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>mean_s <span class="ot">&lt;-</span> <span class="fu">mean</span>(table2<span class="sc">$</span>service_length[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>sd_s <span class="ot">&lt;-</span> <span class="fu">sd</span>(table2<span class="sc">$</span>service_length[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>mean_a <span class="ot">&lt;-</span> <span class="fu">mean</span>(table2<span class="sc">$</span>service_length)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>sd_a <span class="ot">&lt;-</span> <span class="fu">sd</span>(table2<span class="sc">$</span>service_length)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Visualization</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(table2<span class="sc">$</span>service_length[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">0</span>], <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">2.5</span>), </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Self Service"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">13</span>, <span class="at">y =</span> <span class="dv">7</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"mean = "</span>, <span class="fu">round</span>(mean_s, <span class="dv">4</span>), <span class="st">", sd = "</span>, <span class="fu">round</span>(sd_s, <span class="dv">3</span>)))</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(table2<span class="sc">$</span>service_length[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">1</span>], <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">2.5</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Full Service"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">13</span>, <span class="at">y =</span> <span class="fl">1.75</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"mean = "</span>, <span class="fu">round</span>(mean_f, <span class="dv">4</span>), <span class="st">", sd = "</span>, <span class="fu">round</span>(sd_f, <span class="dv">3</span>)))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(table2<span class="sc">$</span>service_length, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">1.25</span>), </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"All Service"</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">13</span>, <span class="at">y =</span> <span class="dv">5</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"mean = "</span>, <span class="fu">round</span>(mean_a, <span class="dv">4</span>), <span class="st">", sd = "</span>, <span class="fu">round</span>(sd_a, <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sample_paths_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>This analysis provides support that potentially self-service customers do indeed have shorter service times, and so providing them with a self-service machine and a separate queue may reduce customer wait times.</p>
<p>This is an example of a <strong>dynamic system</strong>, since what happens to one customer affects the actions of other customers. So far we have examined <strong>sample paths</strong>, which include both factors that are under control (<em>system logic</em>) and factors that are not under control (<em>system inputs</em>).</p>
<hr>
<p><em>A <strong>sample path</strong> is a record of the time-dependent behavior of a system.</em></p>
<p><em><strong>Sample path decomposition</strong> represents a sample path as inputs and logic.</em></p>
<p><em><strong>Simulation</strong> generates new sample paths without building the new system.</em></p>
<p><em><strong>Sample-path analysis</strong> extracts system performance measures from sample paths.</em></p>
<hr>
<p><br></p>
</section>
<section id="simulating-the-self-service-system" class="level2">
<h2 class="anchored" data-anchor-id="simulating-the-self-service-system">Simulating the Self-Service System</h2>
<p>To generate a sample path for the self-service system, we need to define its system logic.</p>
<ul>
<li><p>There will be two queues for customers, who will self-select as self-service (those who require no special handling) and full-service (those who will require special handling performed by the employee).</p></li>
<li><p>Customers will always join the correct queue.</p></li>
<li><p>Service times previously observed will be representative of simulation service times.</p></li>
</ul>
<p>To perform this simulation, we will simulate the two queues - one self-service and one full-service. First, stratify the data by service type, then re-calculate service times and wait times within the new queue system.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#- Split dataset into self-serve and full-serve</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>self_queue <span class="ot">&lt;-</span> table2[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>full_queue <span class="ot">&lt;-</span> table2[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#- To simulate the self-service option, repeat previous service times, wait times calculations within each stratified dataset </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">nrow</span>(self_queue)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>self_queue<span class="sc">$</span>customer_sim1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>self_queue<span class="sc">$</span>finish_time_sim1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>naive_finish <span class="ot">&lt;-</span> self_queue<span class="sc">$</span>arrive_time <span class="sc">+</span> self_queue<span class="sc">$</span>service_length</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>self_queue<span class="sc">$</span>finish_time_sim1[<span class="dv">1</span>] <span class="ot">&lt;-</span> naive_finish[<span class="dv">1</span>]</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>self_queue<span class="sc">$</span>wait_time_sim1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(self_queue)) {</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  self_queue<span class="sc">$</span>finish_time_sim1[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(self_queue<span class="sc">$</span>arrive_time[i] <span class="sc">&gt;</span> naive_finish[i<span class="dv">-1</span>],   <span class="co"># if arrive time is after previous person finishes</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                                           self_queue<span class="sc">$</span>arrive_time[i] <span class="sc">+</span> self_queue<span class="sc">$</span>service_length[i],         <span class="co"># finish_time = arrive + service</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                                           self_queue<span class="sc">$</span>finish_time_sim1[i<span class="dv">-1</span>] <span class="sc">+</span> self_queue<span class="sc">$</span>service_length[i])  <span class="co"># finish_time = finish[i-1] + service </span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  self_queue<span class="sc">$</span>wait_time_sim1[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(self_queue<span class="sc">$</span>arrive_time[i] <span class="sc">&gt;</span> naive_finish[i<span class="dv">-1</span>],     <span class="co"># if arrive time is after previous person finishes</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">0</span>,                                                            <span class="co"># wait time is zero</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                                   self_queue<span class="sc">$</span>finish_time_sim[i<span class="dv">-1</span>] <span class="sc">-</span> self_queue<span class="sc">$</span>arrive_time[i])</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">=</span> <span class="fu">nrow</span>(full_queue)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>full_queue<span class="sc">$</span>customer_sim1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n2</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>full_queue<span class="sc">$</span>finish_time_sim1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n2)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>naive_finish <span class="ot">&lt;-</span> full_queue<span class="sc">$</span>arrive_time <span class="sc">+</span> full_queue<span class="sc">$</span>service_length</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>full_queue<span class="sc">$</span>finish_time_sim1[<span class="dv">1</span>] <span class="ot">&lt;-</span> naive_finish[<span class="dv">1</span>]</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>full_queue<span class="sc">$</span>wait_time_sim1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n2)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(full_queue)) {</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  full_queue<span class="sc">$</span>finish_time_sim1[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(full_queue<span class="sc">$</span>arrive_time[i] <span class="sc">&gt;</span> naive_finish[i<span class="dv">-1</span>],   <span class="co"># if arrive time is after previous person finishes</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>                                           full_queue<span class="sc">$</span>arrive_time[i] <span class="sc">+</span> full_queue<span class="sc">$</span>service_length[i],         <span class="co"># finish_time = arrive + service</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>                                           full_queue<span class="sc">$</span>finish_time_sim1[i<span class="dv">-1</span>] <span class="sc">+</span> full_queue<span class="sc">$</span>service_length[i])  <span class="co"># finish_time = finish[i-1] + service </span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  full_queue<span class="sc">$</span>wait_time_sim1[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(full_queue<span class="sc">$</span>arrive_time[i] <span class="sc">&gt;</span> naive_finish[i<span class="dv">-1</span>],     <span class="co"># if arrive time is after previous person finishes</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>                                         <span class="dv">0</span>,                                                            <span class="co"># wait time is zero</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>                                         full_queue<span class="sc">$</span>finish_time_sim[i<span class="dv">-1</span>] <span class="sc">-</span> full_queue<span class="sc">$</span>arrive_time[i])</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>self_queue[,<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)]  <span class="co"># view datasets, relevant columns only </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   customer arrive_time finish_time_sim1 wait_time_sim1
2         2          14               16              0
3         3          17               18              0
4         4          38               41              0
6         6          43               46              0
7         7          45               47              1
8         8          52               59              0
11       11          74               76              0
12       12          76               86              0
13       13          79               88              7
14       14          88               89              0
16       16         105              107              0
17       17         108              110              0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>full_queue[,<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   customer arrive_time finish_time_sim1 wait_time_sim1
1         1          12               19              0
5         5          39               55              0
9         9          58               61              0
10       10          73               84              0
15       15          96               99              0
18       18         113              121              0
19       19         118              127              3
20       20         120              129              7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- Under factual conditions, average wait time was:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(table2<span class="sc">$</span>wait_time_factual), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- With a self-service queue, average wait-time for potentially self-service customers went from:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(self_queue<span class="sc">$</span>wait_time_factual), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.83</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- to:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(self_queue<span class="sc">$</span>wait_time_sim1), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.67</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- and average wait-time for full-service customers with special needs went from:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(full_queue<span class="sc">$</span>wait_time_factual), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- to:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(full_queue<span class="sc">$</span>wait_time_sim1), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- Overall: </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">c</span>(self_queue<span class="sc">$</span>wait_time_sim1, full_queue<span class="sc">$</span>wait_time_sim1)), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9</code></pre>
</div>
</div>
</section>
<section id="simulating-the-two-machine-full-service-system" class="level2">
<h2 class="anchored" data-anchor-id="simulating-the-two-machine-full-service-system">Simulating the Two-Machine Full-Service System</h2>
<p>Again, we begin by defining the system logic of this experiment:</p>
<ul>
<li>There will be one queue for all customers, with two copy machines each run by an employee who can provide all services.</li>
</ul>
<p>We do not need to work with the stratified dataset, though the indicator variable will allow us to calculate counterfactual wait times</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-- In this simulation, we can serve two customers simultaneously.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>wait_time_sim2 <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>finish_time_sim2 <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a> <span class="co">#- Customers 1 &amp; 2 will be served immediately</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>finish_time_sim2[<span class="dv">1</span>] <span class="ot">&lt;-</span> table2<span class="sc">$</span>arrive_time[<span class="dv">1</span>] <span class="sc">+</span> table2<span class="sc">$</span>service_length[<span class="dv">1</span>]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>finish_time_sim2[<span class="dv">2</span>] <span class="ot">&lt;-</span> table2<span class="sc">$</span>arrive_time[<span class="dv">2</span>] <span class="sc">+</span> table2<span class="sc">$</span>service_length[<span class="dv">2</span>]</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(table2<span class="sc">$</span>arrive_time[i] <span class="sc">&gt;</span> <span class="fu">min</span>(finish_time_sim2[i<span class="dv">-1</span>], finish_time_sim2[i<span class="dv">-2</span>])) {</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    wait_time_sim2[i] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    finish_time_sim2[i] <span class="ot">=</span> table2<span class="sc">$</span>arrive_time[i] <span class="sc">+</span> table2<span class="sc">$</span>service_length[i]</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(table2<span class="sc">$</span>arrive_time[i] <span class="sc">&lt;</span> <span class="fu">min</span>(finish_time_sim2[i<span class="dv">-1</span>], finish_time_sim2[i<span class="dv">-2</span>])) {</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    wait_time_sim2[i] <span class="ot">=</span> <span class="fu">min</span>(finish_time_sim2[i<span class="dv">-1</span>], finish_time_sim2[i<span class="dv">-2</span>]) <span class="sc">-</span> table2<span class="sc">$</span>arrive_time[i]</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    finish_time_sim2[i] <span class="ot">=</span> <span class="fu">min</span>(finish_time_sim2[i<span class="dv">-1</span>], finish_time_sim2[i<span class="dv">-2</span>]) <span class="sc">+</span> table2<span class="sc">$</span>service_length[i]</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co">#-- Under factual conditions, average wait time was:</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(table2<span class="sc">$</span>wait_time_factual), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-- With two full-service queues, average wait time for all customers becomes: </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(wait_time_sim2), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(wait_time_sim2[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">0</span>]), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(wait_time_sim2[table2<span class="sc">$</span>full_service <span class="sc">==</span> <span class="dv">1</span>]), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.12</code></pre>
</div>
</div>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion">Discussion</h3>
<p>From these simulations we can see that both systems are a significant improvement to the one machine + one clerk full-service system, with the two-clerk full-service system providing the shortest wait times. The client would need to weigh this additional improvement against the costs of retaining a second employee, however.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>